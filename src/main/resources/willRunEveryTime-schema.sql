CREATE SCHEMA TICKETING;

CREATE TABLE TICKETING.USER (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  loginId VARCHAR(9) NOT NULL,
  firstName VARCHAR(15) NOT NULL,
  midleName VARCHAR(15),
  lastName VARCHAR(15) NOT NULL,
  type CHAR(1) DEFAULT 'U' NOT NULL,
  password VARCHAR(100),
  createdAt DATETIME,
  updatedAt DATETIME
);

CREATE TABLE TICKETING.ISSUE (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  title VARCHAR(255) NOT NULL,
  description VARCHAR(255) NOT NULL,
  status VARCHAR(20) NOT NULL,
  reporter BIGINT NOT NULL,
  assignee BIGINT,
  created DATE NOT NULL,
  completed DATE
);

CREATE TABLE TICKETING.COMMENT (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  issue BIGINT NOT NULL,
  text VARCHAR(255) NOT NULL,
  commentator BIGINT NOT NULL,
  created DATE NOT NULL
);

ALTER TABLE TICKETING.USER
ALTER COLUMN createdAt
SET DEFAULT CURRENT_TIMESTAMP;

ALTER TABLE TICKETING.COMMENT
ADD FOREIGN KEY (issue)
REFERENCES TICKETING.ISSUE(id);

ALTER TABLE TICKETING.ISSUE
ADD FOREIGN KEY (reporter)
REFERENCES TICKETING.USER(id);

ALTER TABLE TICKETING.ISSUE
ADD FOREIGN KEY (assignee)
REFERENCES TICKETING.USER(id);
